# CSV取込スクリプト

## 前処理
1. タイムアウト検知用のタイマーをセットする
2．S3へZIPファイルの存在をチェックする   
　（存在しない時は終了処理へ）
3. S3からZIPファイルを取得後、一時フォルダに展開する
4. 展開後ファイル（CSV）のファイルサイズをチェックする   
　（NG時は終了処理へ）
5. 登録先のDBをクリアする（RERUN用）

## 取込処理
1. 展開後ファイル（CSV）を1行ずつ読み込む
2. 展開後ファイル（CSV）のバリデーションを項目単位で行う   
2-1. バリデーションNGはNG件数をカウントし、行番号＋エラー内容をエラーファイルに記録する    
　エラーファイル名：入力ファイル名.err.実行日時(YYYYMMDDHHmmss)   
　（次行のデータへ）   
2-2. バリデーションOKはDB登録する   
　（DB登録は100行毎にバルクINSERT＆COMMIT）
3. 取込処理でエラー検知時はDB登録したデータをすべて削除する   
　（終了処理へ）

## 終了処理
1. ZIPファイルを展開した一時フォルダを削除する  
2. 処理結果ステータスを通知する    
2-1. 前処理＋取込処理が正常終了し、バリデーションNGなしの場合、処理成功をメッセージ通知する   
2-2. 前処理＋取込処理が正常終了し、バリデーションNGありの場合、処理一部成功（ファイル名：NG件数）をメッセージ通知し、エラーファイルをS3へアップロードする   
2-3. 前処理または取込処理が異常終了した場合、処理失敗（エラー内容）をメッセージ通知する   
