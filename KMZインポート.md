# KMZインポート

## 画面
### ドロップダウンメニューの追加
|||
|--|--|
|薬剤投下量マップの選択||
|上書き保存||
|名前を付けて保存||
|---||
|生育診断結果の選択|★追加|
|生育診断結果の取込|★追加|
|---||
|薬剤投下量マップの削除||

### レイヤースイッチャーの追加
|||
|--|--|
|薬剤投下量マップ||
|☑生育診断結果|★追加|
|☑背景地図||

### 塗りつぶし方法選択の追加
|||
|--|--|
|生育診断結果解析|★追加|
|単一選択||
|範囲選択||
|すべてクリア||

### 生育診断結果の選択モーダルの追加
##### コンポーネント構成
* サムネイル   
（画像ごとに解析項目、診断結果名、選択ボタン、削除ボタンを表示）

##### イベント
* モーダル表示時に生育診断結果一覧取得APIをCALL   
（PCは2列、Mobileは1列でサムネイル表示）
* 選択ボタンで生育診断結果取得APIをCALL   
生育診断結果レイヤーを生成し地図表示    
（タイトルにも解析項目＋診断結果名を表示）   
（凡例にSPADを表示ol.legend.Image,ol.legend.Legend）
* 削除ボタンで生育診断結果削除APIをCALL   
削除対象を表示していた場合は生育診断結果レイヤーをクリアし地図表示   
（タイトルの解析項目＋診断結果名も削除）
* 削除ボタンは削除確認ダイアログを表示


### 生育診断結果の取込モーダルの追加
##### コンポーネント構成
* ファイルの選択欄（Dropzone）
* 生育診断結果名の入力欄（text）
* 解析項目の選択欄（SPADの一択）
* キャンセルボタン
* アップロードするボタン

##### イベント
* ファイル選択でKMZのプレビュー表示
* アップロードするボタンで生育診断結果登録APIをCALL
* アップロード成功後は生育診断結果レイヤーを生成し地図表示（タイトルにも診断結果名を表示）

## API
### 生育診断結果一覧取得
ユーザーが登録した生育診断結果の一覧取得

##### パラメータ
なし

##### レスポンス
* 生育診断結果ID
* 生育診断名
* 解析項目
* サムネイル

### 生育診断結果取得
指定されたIDの生育診断結果の取得

##### パラメータ
* 生育診断結果ID

##### レスポンス
* 生育診断結果ID
* 生育診断名
* 解析項目
* アイコン
* アイコンBOX

### 生育診断結果登録
生育診断結果の登録

##### パラメータ
* 生育診断名
* 解析項目
* KMZファイル

##### レスポンス
なし

### 生育診断結果削除
指定されたIDの生育診断結果の削除

##### パラメータ
* 生育診断結果ID

##### レスポンス
なし

### 生育診断結果解析
指定されたIDの生育診断結果からマス目ごとの投下レベルを取得

##### パラメータ
* 生育診断結果ID
* メッシュのマス目（投下量レベルなし）

##### レスポンス
* メッシュのマス目（投下量レベルあり）

## DB
### 生育診断結果（growth_diag_results）

|項目|属性||
|--|--|--|
|生育診断結果ID|serial||
|生育診断名|VCHAR|
|解析項目|int|1:SPAD|
|アイコンBOX|geometry|multipoint|
|アイコン|bytea|1000px超は1/10に縮小|
|サムネイル|bytea|幅200px超は幅200pxに縮小|


### 施肥設計（fertilization-designs）

|項目|属性||
|--|--|--|
|生育診断結果ID|int|列追加|